generator client {
  provider        = "prisma-client-js"
  output          = "../generated/node"
  previewFeatures = ["postgresqlExtensions"]
  binaryTargets   = ["native", "rhel-openssl-3.0.x", "linux-arm64-openssl-3.0.x", "linux-musl-arm64-openssl-3.0.x"]
}

generator edge {
  provider        = "prisma-client-js"
  output          = "../generated/edge"
  previewFeatures = ["driverAdapters", "postgresqlExtensions"]
  binaryTargets   = ["native"]
}

generator zod {
  provider = "zod-prisma-types"
  output   = "../generated/zod-prisma-validators"
}

datasource db {
  provider   = "postgresql"
  url        = env("DATABASE_URL")
  directUrl  = env("DIRECT_URL")
  extensions = [uuid_ossp(map: "uuid-ossp", schema: "extensions"), vector]
}

model User {
  id                   String     @id
  firstName            String?
  lastName             String?
  username             String?    @unique
  primaryEmailAddress  String     @unique
  imageUrl             String?
  clerkUserProperties  Json?
  stripeCustomerId     String?    @unique
  accessType           AccessType @default(FREE)
  stripeUserProperties Json?
  dailyAIcomments      Int        @default(0)
  creditConsumed       Int        @default(0)
  createdAt            DateTime   @default(now())
  updatedAt            DateTime   @updatedAt
}

enum AccessType {
  FREE
  WEEKLY
  MONTHLY
  YEARLY
}

/// Minimal asset tracking for Gif Avatar
model UserUpload {
  id             String   @id @default(cuid())
  userId         String
  path           String
  mime           String
  defaultStyle   String?
  defaultBgColor String?
  createdAt      DateTime @default(now())

  @@index([userId])
}

model BackgroundRemoved {
  id             String   @id @default(cuid())
  userId         String
  sourceUploadId String
  path           String
  createdAt      DateTime @default(now())

  @@index([userId])
  @@index([sourceUploadId])
}

model UserResult {
  id             String   @id @default(cuid())
  userId         String
  path           String
  sourceUploadId String?
  createdAt      DateTime @default(now())

  @@index([userId])
  @@index([sourceUploadId])
}

enum SocialPlatform {
  X
  THREADS
  FACEBOOK
  LINKEDIN
}

enum SocialSubmissionStatus {
  VERIFYING
  VALIDATED
  INVALID
  DUPLICATE
  VALIDATION_FAILED
}

model SocialSubmission {
  id                  String                 @id @default(cuid())
  userId              String
  platform            SocialPlatform
  originalUrl         String
  urlNormalized       String                 @unique
  status              SocialSubmissionStatus @default(VERIFYING)
  requiredKeywords    String[]
  missingKeywords     String[]
  matchedKeywords     String[]
  postText            String?
  likes               Int                    @default(0)
  comments            Int                    @default(0)
  shares              Int                    @default(0)
  bestEngagementTotal Int                    @default(0)
  creditAwarded       Int                    @default(0)
  creditPenalty       Int                    @default(0)
  rescanCount         Int                    @default(0)
  verifiedAt          DateTime?
  lastAttemptAt       DateTime?
  errorMessage        String?
  createdAt           DateTime               @default(now())
  updatedAt           DateTime               @updatedAt

  @@index([userId, status])
  @@index([userId, createdAt])
}
